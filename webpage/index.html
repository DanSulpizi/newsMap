<!DOCTYPE html>
<html>
    <head>
        <meta charset=utf-8 />
        <title>NewsMap</title>
        <script src="jquery-1.11.1.min.js"></script>
        

        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
        <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
        
        <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
        <link rel="stylesheet" href="style.css" type="text/css" />
    </head>
    <body>
            <div id='map'></div>

        <script>
        $(document).ready(function () {
            var mapboxTiles = L.tileLayer('https://{s}.tiles.mapbox.com/v3/dansulpizi.j17d6k3p/{z}/{x}/{y}.png', {
                attribution: '<a href="http://www.mapbox.com/about/maps/" target="_blank">Terms &amp; Feedback</a>'
            });

            var map = L.map('map')
                .addLayer(mapboxTiles)
                .setView([30,0], 2);
            
            var locationInfo;            
            
            $.ajax({
                url: "data.txt",
                async: false,
                dataType: 'json',
                success: function(data) {
                    locationInfo = data;
                }
            });
            
            console.log(locationInfo);
            for(var key in locationInfo){
                latitude = locationInfo[key][0].lat;
                longitude = locationInfo[key][0].long;
                var marker = L.marker([latitude, longitude]).addTo(map);
                var news = "";
                for(var key2 in locationInfo[key]){
                    var newsStory = "<a href="+locationInfo[key][key2].url+">"+locationInfo[key][key2].headline+"</a><br>"
                    +"<br>";
                    
                    news = news.concat(newsStory);
                }
                marker.bindPopup(news);
            }

        });
        </script>
    </body>
</html>